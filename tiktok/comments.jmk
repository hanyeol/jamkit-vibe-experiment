=begin popup
type = "comments"
video = $data.video
=end

=begin layout: comments
{
    "type": "view",
    "style": {
        "width": "1pw",
        "height": "0.7ph",
        "background-color": "#FFFFFF",
        "border-radius-top-left": "20",
        "border-radius-top-right": "20"
    },
    "components": [
        {
            "type": "view",
            "style": {
                "width": "1pw",
                "padding": "15",
                "border-bottom-width": "1",
                "border-color": "#E0E0E0",
                "align": "center"
            },
            "components": [
                {
                    "type": "view",
                    "style": {
                        "width": "40",
                        "height": "4",
                        "background-color": "#CCCCCC",
                        "border-radius": "2",
                        "margin-bottom": "10"
                    }
                },
                {
                    "type": "text",
                    "text": "={{$video.comments + \" ê°œì˜ ëŒ“ê¸€\"}}",
                    "style": {
                        "font-size": "16",
                        "font-weight": "bold"
                    }
                }
            ]
        },
        {
            "type": "scroll",
            "style": {
                "width": "1pw",
                "height": "=(0.7ph - 150)",
                "padding": "15"
            },
            "components": [
                {
                    "type": "list",
                    "data": "$comments_data",
                    "components": [
                        {
                            "type": "comment-item",
                            "comment": "={{$item}}"
                        }
                    ]
                }
            ]
        },
        {
            "type": "view",
            "style": {
                "position": "absolute",
                "bottom": "0",
                "left": "0",
                "right": "0",
                "height": "60",
                "background-color": "#F8F8F8",
                "border-top-width": "1",
                "border-color": "#E0E0E0",
                "padding": "10",
                "flex-direction": "row",
                "align-items": "center"
            },
            "components": [
                {
                    "type": "image",
                    "url": "https://i.pravatar.cc/150?img=10",
                    "style": {
                        "width": "40",
                        "height": "40",
                        "border-radius": "20",
                        "margin-right": "10"
                    }
                },
                {
                    "type": "input",
                    "id": "comment-input",
                    "placeholder": "ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”...",
                    "style": {
                        "flex": "1",
                        "height": "40",
                        "background-color": "#FFFFFF",
                        "border-radius": "20",
                        "padding-left": "15",
                        "padding-right": "15",
                        "margin-right": "10"
                    }
                },
                {
                    "type": "button",
                    "text": "ê²Œì‹œ",
                    "action": "post-comment",
                    "style": {
                        "width": "60",
                        "height": "40",
                        "background-color": "#FE2C55",
                        "color": "#FFFFFF",
                        "border-radius": "20",
                        "font-weight": "bold"
                    }
                }
            ]
        }
    ]
}
=end

=begin component: comment-item
{
    "type": "view",
    "style": {
        "width": "1pw",
        "padding-top": "10",
        "padding-bottom": "10",
        "flex-direction": "row"
    },
    "components": [
        {
            "type": "image",
            "url": "={{$comment.avatar}}",
            "style": {
                "width": "40",
                "height": "40",
                "border-radius": "20",
                "margin-right": "10"
            }
        },
        {
            "type": "view",
            "style": {
                "flex": "1"
            },
            "components": [
                {
                    "type": "text",
                    "text": "={{$comment.username}}",
                    "style": {
                        "font-size": "14",
                        "font-weight": "bold",
                        "margin-bottom": "5"
                    }
                },
                {
                    "type": "text",
                    "text": "={{$comment.text}}",
                    "style": {
                        "font-size": "14",
                        "margin-bottom": "5"
                    }
                },
                {
                    "type": "view",
                    "style": {
                        "flex-direction": "row"
                    },
                    "components": [
                        {
                            "type": "text",
                            "text": "={{$comment.time}}",
                            "style": {
                                "font-size": "12",
                                "color": "#999999",
                                "margin-right": "15"
                            }
                        },
                        {
                            "type": "text",
                            "text": "={{$comment.likes + \" ì¢‹ì•„ìš”\"}}",
                            "style": {
                                "font-size": "12",
                                "color": "#999999",
                                "margin-right": "15"
                            }
                        },
                        {
                            "type": "text",
                            "text": "ë‹µê¸€ ë‹¬ê¸°",
                            "action": "reply-comment",
                            "style": {
                                "font-size": "12",
                                "color": "#999999",
                                "font-weight": "bold"
                            }
                        }
                    ]
                }
            ]
        },
        {
            "type": "view",
            "action": "toggle-comment-like",
            "style": {
                "align": "center"
            },
            "components": [
                {
                    "type": "image",
                    "url": "heart-icon.png",
                    "style": {
                        "width": "20",
                        "height": "20",
                        "tint-color": "={{$comment.liked == \"true\" ? \"#FE2C55\" : \"#999999\"}}"
                    }
                }
            ]
        }
    ]
}
=end

=begin data: comments_data
[
    {
        "id": "1",
        "username": "ìœ ì €1",
        "avatar": "https://i.pravatar.cc/150?img=11",
        "text": "ì •ë§ ë©‹ì§„ ì˜ìƒì´ë„¤ìš”! ğŸ‘",
        "time": "2ì‹œê°„ ì „",
        "likes": "45",
        "liked": "false"
    },
    {
        "id": "2",
        "username": "ìœ ì €2",
        "avatar": "https://i.pravatar.cc/150?img=12",
        "text": "ì™€ ì´ê±° ì–´ë–»ê²Œ ì°ìœ¼ì‹  ê±°ì˜ˆìš”??",
        "time": "1ì‹œê°„ ì „",
        "likes": "23",
        "liked": "false"
    },
    {
        "id": "3",
        "username": "ìœ ì €3",
        "avatar": "https://i.pravatar.cc/150?img=13",
        "text": "ëŒ€ë°•!! ì €ë„ í•œë²ˆ í•´ë³´ê³  ì‹¶ì–´ìš” ã…ã…",
        "time": "30ë¶„ ì „",
        "likes": "12",
        "liked": "false"
    },
    {
        "id": "4",
        "username": "ìœ ì €4",
        "avatar": "https://i.pravatar.cc/150?img=14",
        "text": "ë„ˆë¬´ ì¬ë¯¸ìˆì–´ìš” ğŸ˜‚",
        "time": "15ë¶„ ì „",
        "likes": "8",
        "liked": "false"
    },
    {
        "id": "5",
        "username": "ìœ ì €5",
        "avatar": "https://i.pravatar.cc/150?img=15",
        "text": "ë‹¤ìŒ ì˜ìƒë„ ê¸°ëŒ€í• ê²Œìš”!",
        "time": "5ë¶„ ì „",
        "likes": "3",
        "liked": "false"
    }
]
=end

=begin action: post-comment
$comment_text = component-val("comment-input")

if $comment_text != ""
    $new_comment = {
        "id": (($comments_data | length) + 1) | string,
        "username": "ë‚˜",
        "avatar": "https://i.pravatar.cc/150?img=10",
        "text": $comment_text,
        "time": "ë°©ê¸ˆ",
        "likes": "0",
        "liked": "false"
    }

    $comments_data = [$new_comment] + $comments_data
    $video.comments = (($video.comments | number) + 1) | string

    component-set("comment-input", "")
end
=end

=begin action: toggle-comment-like
if $comment.liked == "true"
    $comment.liked = "false"
    $comment.likes = (($comment.likes | number) - 1) | string
else
    $comment.liked = "true"
    $comment.likes = (($comment.likes | number) + 1) | string
end
=end

=begin action: reply-comment
component-focus("comment-input")
component-set("comment-input", "@" + $comment.username + " ")
=end
